"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const testCaseStatus_1 = __importDefault(require("../helper/testCaseStatus"));
const index_1 = require("./index");
/**
 * REGEX To identify Case References in Test Titles like 'My Test [12345]'
 */
const CASE_REGEX = /(^.*)\[(\d*(,\s*\d+)*)\]/;
function parseTests(tests, cases) {
    tests.forEach((test) => {
        if (CASE_REGEX.test(test.fullTitle)) {
            const titleParts = CASE_REGEX.exec(test.fullTitle);
            const [, title, caseIds] = titleParts || ['', ''];
            caseIds.split(',').forEach((id) => {
                const caseId = id.trim();
                // eslint-disable-next-line no-param-reassign
                cases[caseId] = Object.assign(Object.assign({}, (cases[caseId] || {})), { caseId, results: [
                        ...(cases[caseId] ? cases[caseId].results : []),
                        testCaseStatus_1.default(test),
                    ], err: [
                        ...(cases[caseId] ? cases[caseId].err : []),
                        index_1.getErrorForTest(test, title),
                    ].filter(Boolean) });
            });
        }
        return false;
    });
    return cases;
}
exports.default = parseTests;
